#regression tests, i.e. compare gapc output with truth
DEFAULT_LDLIBS_EXTRA=$LDLIBS_EXTRA
DEFAULT_CPPFLAGS_EXTRA=$CPPFLAGS_EXTRA
DEFAULT_GAPC=$GAPC

check_new_old_eq elm.gap unused enum 1+2*3*4+5 foo

check_new_old_eq loco3stem.gap unused count caucguacgucagucguagucaguugcagugcaucgacua foo

check_new_old_eq loco3stem.gap unused count gggcguucucauagguccgcguggguuagacauucaagguuauuuuuuauccggaguuaccucaucuaauugauagauuaagaaauucuuuuguucgaauaaggcgcaguuauuuacccuuuugauuccuaaaaacuuuccgccgccgucaagaugacaaauaacaaacuugccaaggcggcauccguuuuuagauaauu bar

GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq rnashapes2wip.gap unused mfepp gcgcggugcgucacgcaucacauacucaucaacgaugagaagc foo

check_new_old_eq rnashapespf.gap unused pf GGAGAGAUGGCUGAGUGGUUGAUAGCUCCGGUCUUGAAAACCGGUAUAGUUCUAGGAACUAUCGAGGGUUCGAAUCCCUCUCUCUCCUGGAGAGAUGGCUGAGUGGUUGAUAGCUCCGGUCUUGAAAACCGGUAUAGUUCUAGGAACUAUCGAGGGUUCGAAUCCCUCUCUCUCCU pf

RUN_CPP_FLAGS=""

check_new_old_eq cmsmallint.gap unused enum a foo

RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq adpf.gap unused shapemfepp acgugucagucagucauggucaucauacugccgua foo

CPPFLAGS_EXTRA+="-DSTATS"

# FIXME, with optimized classify, the stat-ing of one hash-table is of no use
# ugucgcccgaccuguaaucgauuguuauuuccaggcucgagggcaagucuugaaaggacuaccuugucgaaguggacagugcagcgauugacggauucagucggggcauauugugcauaaugucagc
#check_feature adpf.gap shape5 ugucgcccgaccuguaaucgauuguuauuuccaggcucgagggcaagucuugaaaggacuaccuugucgaaguggacagug foo err grep "Hi water use: 428785\>"

CPPFLAGS_EXTRA=$DEFAULT_CPPFLAGS_EXTRA

GAPC="../../../gapc -t --window-mode"

RUN_CPP_FLAGS="-w 20 -i 5"

check_new_old_eq adpf.gap unused bpmaxpp auagacguguaauuauugaggaacaggcaucgaucauaauaggguaucagggauacaugaauaggcuuagcgucaguuguuggcuauuccaucaucggguacaauuccauacuucgcaugggaucaaccaagcucuaguggccgccuaug foo

RUN_CPP_FLAGS="-w 23 -i 8"

check_new_old_eq adpf.gap unused bpmaxpp auagacguguaauuauugaggaacaggcaucgaucauaauaggguaucagggauacaugaauaggcuuagcgucaguuguuggcuauuccaucaucggguacaauuccauacuucgcaugggaucaaccaagcucuaguggccgccuaug bar

RUN_CPP_FLAGS="-w 100 -i 50 -P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq adpf.gap unused mfepp cuccccucuucggacgcaacuuaugccuaggaccuauuuugcacagaaugagggcuagggaagagccgucccucagugagcagaguuaaguuguuguuugaguaacucccggcgggcuaagccauugcacccaaccgcuugccugucauucuggaccgggauggaaccguaccucugcacuuaagacagacuaucaaaagcguauggcggguuguggucucaagugggaggacaaucaccguauauuugaucaacgauucagggaugcucacccguuucuuauuugaaacuuggcacccggaauauucugaagccaauacaguuugugacacaaccccgucaguugagacucuuuuaacgccgugugccgacgaaucuccccacgguaugcgcuggucggucccacgagggcguauaucgccaaggcagcuuaugguaacgucgcauaccagcucaagccgguugaaauaacagguccaguuuguaggucucuucugugacguaggccugcagcaagaacugcgcaugcuugucguagaggccaauagagcugaucuggcaaucguaaagguaguguuuagguagcuucauguauucaucuuucgucaucgcaagcuaaacuugcgcucaucacuauggcgucaucugaggucguugcgagaaagaugcuagguugcgcgcauaacgacuuuaagcguuagauuccgccucucaucgggccagcgaaagacccauacgcaaacgcgcuaucgcaguaauggaauaauuggcaguacucaucgccggcgucgcuauguucuaugcucacgcucucuccaggcggcggauggucccugccagcgcucgagaggcauccaaguuggaacuauauccuaugaaucacaaugccggucacuucgcgggcuaauaaguuccucaggggaccaggacgugauuuuccgugcagggggggccggucacacgcaggagguuugggcuagcacaagcccaacaaccacau foo

GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-f"

check_new_old_eq adpf.gap unused shape5 "../../input/rna127" bar

RUN_CPP_FLAGS=""
CPPFLAGS_EXTRA+=" -DUSE_GMP_INT"
# under Linux -lgmpxx pulls automatically -lgmp, Solaris does not
LDLIBS_EXTRA+=" -lgmp -lgmpxx"

check_new_old_eq elm.gap unused acount '1+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+11+2*3*4+5*3*2*2*3*1+1+3+1' foo

CPPFLAGS_EXTRA=$DEFAULT_CPPFLAGS_EXTRA
LDLIBS_EXTRA=$DEFAULT_LDLIBS_EXTRA

# Jens subopt old adpc bug report 1

GAPC="../../../gapc -t --subopt"

# 30 %
RUN_CPP_FLAGS="-d 552 -P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq rnashapesmfe.gap unused mfepp ugcuagucagcuaucgacucgugcagcaguacgaucagcauagcuagcacuacgcua subopt30

# 31 %
GAPC="../../../gapc -t --cyk --subopt"
RUN_CPP_FLAGS="-d 570 -P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq rnashapesmfe.gap unused mfepp ugcuagucagcuaucgacucgugcagcaguacgaucagcauagcuagcacuacgcua subopt31

# Jens subopt old adpc bug report 2 (prob sum > 1.0)

GAPC="../../../gapc -t --subopt"
RUN_CPP_FLAGS="-d 1090 -P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq adpf_nonamb.gap unused mfepppf CCacaccaacacacCuGuCACGGGAGAGAAuGuGGGuuCAAAuCCCAuCGGuCGCGCCA subopt

check_feature adpf_nonamb.gap mfepppf CCacaccaacacacCuGuCACGGGAGAGAAuGuGGGuuCAAAuCCCAuCGGuCGCGCCA suboptpfsum out $KSH ../check_prob_sum 9.33773

#

# another Jens subopt RNAshapes -r -s  Probability sum > 1.0 bug
# mail from Date: Fri, 13 Feb 2009 11:16:32

RUN_CPP_FLAGS="-d 224 -P ../../../librna/paramfiles/rna_turner1999.par"

check_feature adpf_nonamb.gap mfepppf UCACCGUCGGAAAGUGUGCGCUUUCCCUGAUGAGCCCAAAAGGGCGAAACGGUAC suboptpfsum2 out $KSH ../check_prob_sum 5.06405e+08

#

GAPC="../../../gapc -t"

check_new_old_eq adpf_nonamb.gap unused shape5pf CCacaccaacacacCuGuCACGGGAGAGAAuGuGGGuuCAAAuCCCAuCGGuCGCGCCA shapesubopt

GAPC="../../../gapc --tab-all"
RUN_CPP_FLAGS="-f"

# FIXME remove - obsoleted by external test case, which is more robust
#check_new_old_eq adpf_nonamb.gap unused shape5pfx ../../input/rna150 shapefpffilter


#GSL_RNG_SEED=`../rand 1`
#export GSL_RNG_SEED

RUN_CPP_FLAGS="-r 1000 -P ../../../librna/paramfiles/rna_turner1999.par -f"
GAPC="../../../gapc -t --sample"

check_feature adpf.gap pfsampleshape ../../input/rna100 sample out $KSH ../check_samples ../adpf.rna100shapepf 0.000349275 0.00005


# Sequence from Jens RNAshapes sampling mode bug report

RUN_CPP_FLAGS="-r 1000 -P ../../../librna/paramfiles/rna_turner1999.par"

check_feature adpf_nonamb.gap pfsampleshape AGAGAACAUGAGAGAGAUUCCCAACAGAGGCCUGCACGCACUUGGACUCU sample out $KSH ../check_samples ../nonamb_shape_pf.log 6.33459e-05 0.00005

# Sequence from Jens RNAshapes sampling mode bug report, distribution test

RUN_CPP_FLAGS="-r 1000 -P ../../../librna/paramfiles/rna_turner1999.par"

check_feature_repeat_mean_var adpf_nonamb.gap pfsampleshape AGAGAACAUGAGAGAGAUUCCCAACAGAGGCCUGCACGCACUUGGACUCU sample2

# Too much sample output bug ( see a9fed4287fda and 980a3871b4a7 )
GAPC="../../../gapc -t --sample --cyk"
RUN_CPP_FLAGS="-r 1 -P ../../../librna/paramfiles/rna_turner1999.par -f"
check_feature adpf_nonamb.gap pfsampleshapeall ../../input/rna400 samplecount out $KSH ../check_sample_count

RUN_CPP_FLAGS="-f"
GAPC="../../../gapc -t"

check_new_old_eq nussinov.gap unused bpmax1pp ../../input/rna150 takeone

CPPFLAGS_EXTRA+=" -DUSE_GMP_INT"
LDLIBS_EXTRA+=" -lgmp -lgmpxx"

check_new_old_eq adpf.gap unused cart ../../input/rna150 cartesian

GAPC="../../../gapc -t --backtrack"

check_new_old_eq adpf.gap unused cartpp2 ../../input/rna20 cartesian2

CPPFLAGS_EXTRA=$DEFAULT_CPPFLAGS_EXTRA
LDLIBS_EXTRA=$DEFAULT_LDLIBS_EXTRA

RUN_CPP_FLAGS="-f"
GAPC="../../../gapc -t --backtrack"

check_new_old_eq nussinov.gap unused bpmax1pp ../../input/rna150 takeonebt

GAPC="../../../gapc -t --kbacktrack"
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq adpf_nonamb.gap unused shapemfepf acgccucuucgaaguucaggauuugaccgccgcaugcgaacucggauuacgaaacauuuc kbt

# FIXME remove - obsoleted by external test case, which is more robust
#check_new_old_eq adpf_nonamb.gap unused shapemfepfx acgccucuucgaaguucaggauuugaccgccgcaugcgaacucggauuacgaaacauuuc kbtpfx

RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par -f"
GAPC="../../../gapc -t --cyk --kbacktrack"

check_new_old_eq helene.gap unused mfepp ../../input/rna100 rope


check_external extpfx ../check_shape_filter_old_new "../../test/shapemfepfx/main -w 2 -i 1 -P ../../../librna/paramfiles/rna_turner1999.par" $REF/shapemfepfx.150.log 0.000001 0.000001 2 `cat ../../input/rna150`

check_external extsample ../check_shape_filter "../../test/shrepmfesample/main -r 2000 -P ../../../librna/paramfiles/rna_turner1999.par" $REF/shrepmfesample.2000.150.log 0.0002 0.0002 1 `cat ../../input/rna150`


check_external extpfxwindow ../../test/shapemfepfx/test.pl ../../test/shapemfepfx/main ../../test/shapemfepfx/nowindow `cat ../../input/rna100`


#RUN_CPP_FLAGS="-x -300 -f"
# thresh of 0
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par -f"
GAPC="../../../gapc -t --kbacktrack --cyk"

check_new_old_eq adpf_hl.gap unused mfepp ../../input/rna200 suchthat


GAPC="../../../gapc -t --cyk --subopt-classify --kbacktrack"
RUN_CPP_FLAGS="-d 0 -P ../../../librna/paramfiles/rna_turner1999.par -f"

check_new_old_eq adpf.gap unused shapemfepp ../../input/rna80 subshape

RUN_CPP_FLAGS="-d 50 -P ../../../librna/paramfiles/rna_turner1999.par -f"
check_new_old_eq adpf.gap unused shapemfepp ../../input/rna80 subshape2

RUN_CPP_FLAGS="-d 100 -P ../../../librna/paramfiles/rna_turner1999.par -f"
check_new_old_eq adpf.gap unused shapemfepp ../../input/rna80 subshape3

RUN_CPP_FLAGS="-d 429 -P ../../../librna/paramfiles/rna_turner1999.par -f"
check_new_old_eq adpf.gap unused shapemfepp ../../input/rna20 subshape4

RUN_CPP_FLAGS="-d 430 -P ../../../librna/paramfiles/rna_turner1999.par -f"
check_new_old_eq adpf.gap unused shapemfepp ../../input/rna20 subshape5

RUN_CPP_FLAGS="-d 100 -P ../../../librna/paramfiles/rna_turner1999.par -f"
check_new_old_eq adpf_nonamb.gap unused shapemfepp ../../input/rna80 subshape8

RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par -f"
GAPC="../../../gapc -t --cyk --kbacktrack"
check_new_old_eq adpf.gap unused shapemfeppcl ../../input/rna20 subshape6

check_new_old_eq adpf.gap unused shapemfeppshcl ../../input/rna20 subshape7

RUN_CPP_FLAGS=""


# FIXME tab heuristic (-t) is not optimal for this grammar
GAPC="../../../gapc --tab-all"
check_new_old_eq structure2shape.gap unused shape5 '..(((...((......))...(((.....)))....)))..' structure


GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-f"
check_new_old_eq flowgram.gap unused foo ../../input/flow  flow

RUN_CPP_FLAGS="-w 20 -i 5 -P ../../../librna/paramfiles/rna_turner1999.par -f"
GAPC="../../../gapc -t --backtrack --window-mode"
check_new_old_eq adpf.gap unused mfepp ../../input/rna80 windowbacktrack

RUN_CPP_FLAGS="-w 20 -i 1 -P ../../../librna/paramfiles/rna_turner1999.par -f"
GAPC="../../../gapc -t --kbacktrack --no-coopt --window-mode"
check_new_old_eq adpf.gap unused mfepp ../../input/rna80 windowkbacktrack

RUN_CPP_FLAGS=""
GAPC="../../../gapc -t"
check_new_old_eq g3pl.gap unused shapeprobls acgucguagucagucaacguacgucagu classlogspace

GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-f"
check_new_old_eq flowgram2b.gap unused score ../../input/flow.2  multitrack.flow

GAPC="../../../gapc -t --cyk --kbacktrack"
check_new_old_eq flowgram2b.gap unused foo ../../input/flow.2  multitrack.flow


# multiple singleton {} blocks in grammar (see nt_stem)

RUN_CPP_FLAGS=""
GAPC="../../../gapc -t"

check_new_old_eq single_block.gap unused count CCAAAGG block

check_new_old_eq elm.gap unused enumenum '1+2*3' prodcopy

check_new_old_eq optimalMCM.gap unused minmemminmult '[3x4]*[4x3]' extends


# test case for multiple classifying choice fns -> classify optimization
# minimal example for part of the pknotsRG multi choice fns classify bug
check_new_old_eq mchoice.gap unused shape 'gattaca' multiplechoiceclass

# FIXME add pknotsRG shape5

GAPC="../../../gapc -t --cyk --kbacktrack"
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq pknotsRG.gap unused mfepp 'acgucgaaauaaaugccuugucugcuauauucgacgcgagcuuaauauuuggggcc' index


GAPC="../../../gapc -t "

check_new_old_eq tdm2hp.gap unused pretty aaacccggggaauuccuu tabledim
check_new_old_eq tdm2hporig.gap unused pf gaauacccacggaugguagauuucgcuuuugggugaacuugccacgcccccgacggucgcgagcuuaucugcuauaccccaauugagaauacagggaacuu tabledim


GAPC="../../../gapc -t --kbacktrace --no-coopt"
RUN_CPP_FLAGS=""

check_new_old_eq nussinov2.gap unused bpmaxpp caguagucagcu nocooptkbt

GAPC="../../../gapc -t --kbacktrace "
RUN_CPP_FLAGS=" gggaaaaccc "

check_new_old_eq multfilter.gap unused bpmaxpp aggaaaacca multitrack.filter

GAPC="../../../gapc -t  "
RUN_CPP_FLAGS=" cagu "

check_new_old_eq aliglob2.gap unused enum cag multitrack.enum


RUN_CPP_FLAGS=""

check_compiler_output ../../grammar2 elmnoterm.gap buyer compile grep "Function char is not defined"

GAPC="../../../gapc -t  "
RUN_CPP_FLAGS=""
GRAMMAR=../../grammar2

check_new_old_eq multigrammar.gap unused seller '1+2*3*4+5' multigrammar

check_new_old_eq ochoice.gap unused buyer '1+2*3*4+5' optchoice


GAPC="../../../gapc --tab-all  "
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"
GRAMMAR=../../grammar2

check_new_old_eq p7.gap unused mfe 'gagacugcagucc' tablegen
check_new_old_eq p72.gap unused mfe 'gagacugcagucc' tablegen

GAPC="../../../gapc --tab-all --cyk --kbacktrace"
GRAMMAR=../../grammar2
RUN_CPP_FLAGS=""

check_new_old_eq rf01380.gap unused cykpp 'AGUCA' tablegen.rightlin

GAPC="../../../gapc -t --kbest"
RUN_CPP_FLAGS="-k 5 -P ../../../librna/paramfiles/rna_turner1999.par -f"
GRAMMAR=../../grammar

check_new_old_eq adpf.gap unused shapemfe ../../input/rna200 kbest


GAPC="../../../gapc --tab-all"
RUN_CPP_FLAGS="AA "
GRAMMAR=../../grammar2
check_new_old_eq menum.gap unused enumi "AA" multi.enum


RUN_CPP_FLAGS=""
GAPC="../../../gapc -t "
GRAMMAR=../../grammar2

check_compiler_output ../../grammar2 ttcounterr.gap test compile.multi grep "does not match"

GRAMMAR=../../grammar
GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"

check_new_old_eq adpf.gap unused mfepp UUGCGCCGAUGGUUUGAGCAGCAACGCGAUCUACUUUCCAUCAGGAUAAACGUUGACUUUUAGUAAGAAACACAGCCUCAGCUAGGCUGCCCUUAUAGUUCAACG mfe1.t1999
check_new_old_eq adpf.gap unused mfepp CCCUGAUACCCUCAUGCCUCGUGG mfe2.t1999
check_new_old_eq adpf.gap unused mfepp GGCGAGCGAGCCCCGGGCGGACGCGCGCCCGAAACGGGCGCGCGCCGCCCGGAAAGGCACGCCGCC mfe3.t1999

GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner2004.par"

check_new_old_eq adpf.gap unused mfepp UUGCGCCGAUGGUUUGAGCAGCAACGCGAUCUACUUUCCAUCAGGAUAAACGUUGACUUUUAGUAAGAAACACAGCCUCAGCUAGGCUGCCCUUAUAGUUCAACG mfe1.t2004
check_new_old_eq adpf.gap unused mfepp CCCUGAUACCCUCAUGCCUCGUGG mfe2.t2004
check_new_old_eq adpf.gap unused mfepp GGCGAGCGAGCCCCGGGCGGACGCGCGCCCGAAACGGGCGCGCGCCGCCCGGAAAGGCACGCCGCC mfe3.t2004


RUN_CPP_FLAGS="-t 50.742 -P ../../../librna/paramfiles/rna_turner1999.par"

GAPC="../../../gapc -t"

check_new_old_eq adpf.gap unused mfepp UUGCGCCGAUGGUUUGAGCAGCAACGCGAUCUACUUUCCAUCAGGAUAAACGUUGACUUUUAGUAAGAAACACAGCCUCAGCUAGGCUGCCCUUAUAGUUCAACG temp50.mfe1.t1999
check_new_old_eq adpf.gap unused mfepp CCCUGAUACCCUCAUGCCUCGUGG temp50.mfe2.t1999
check_new_old_eq adpf.gap unused mfepp GGCGAGCGAGCCCCGGGCGGACGCGCGCCCGAAACGGGCGCGCGCCGCCCGGAAAGGCACGCCGCC temp50.mfe3.t1999

GAPC="../../../gapc -t"
RUN_CPP_FLAGS="-t 50.742 -P ../../../librna/paramfiles/rna_turner2004.par"

check_new_old_eq adpf.gap unused mfepp UUGCGCCGAUGGUUUGAGCAGCAACGCGAUCUACUUUCCAUCAGGAUAAACGUUGACUUUUAGUAAGAAACACAGCCUCAGCUAGGCUGCCCUUAUAGUUCAACG temp50.mfe1.t2004
check_new_old_eq adpf.gap unused mfepp CCCUGAUACCCUCAUGCCUCGUGG temp50.mfe2.t2004
check_new_old_eq adpf.gap unused mfepp GGCGAGCGAGCCCCGGGCGGACGCGCGCCCGAAACGGGCGCGCGCCGCCCGGAAAGGCACGCCGCC temp50.mfe3.t2004

RUN_CPP_FLAGS="-f"
GRAMMAR=../../grammar2
GAPC="../../../gapc -t"

check_new_old_eq escape.gap unused acount ../../input/esc esc

RUN_CPP_FLAGS="c"
GRAMMAR=../../grammar2
GAPC="../../../gapc -t --kbacktrace"

# from mmoehl
check_new_old_eq interaction.gap unused bpmaxpp g multitrack.kbt

GAPC="../../../gapc -t "
GRAMMAR=../../grammar2
RUN_CPP_FLAGS="abc"

check_new_old_eq mcount.gap unused cnt abc multitrack.count

RUN_CPP_FLAGS="ac"

check_new_old_eq trackpos.gap unused cnt dc multitrack.trackpos

GRAMMAR=../../grammar2
RUN_CPP_FLAGS=""

check_new_old_eq overlay.gap unused count '1+2*3*4*5' overlay

GAPC="../../../gapc -t --kbacktrace"
RUN_CPP_FLAGS="-P ../../../librna/paramfiles/rna_turner1999.par"
check_new_old_eq backtraceminys.gap unused  mfepre a kbt

GAPC="../../../gapc -t --cyk"
RUN_CPP_FLAGS=""

GRAMMAR=../../grammar2

check_new_old_eq adpfiupac.gap unused mfepp agcugucaugcagucguagucaguca iupac

GRAMMAR=../../grammar2
check_new_old_eq locomotif.gap unused pretty acugacugaacuguacguugaugac foo

#test for new functions to rope: "front", "back" and "tail". For MacOSx the shape datatype has problems with hashing, thus we need a rope version for the shape algebras, but that rope first has to implement the aforementioned functions.
GRAMMAR=../../grammar
GAPC="../../../gapc"
check_new_old_eq macrostate.gap unused shape1count acuguagucugagucacguuaucuggucguaucgaucgaucgaucacuguaguc shape_t
check_new_old_eq macrostate.gap unused shape1ropecount acuguagucugagucacguuaucuggucguaucgaucgaucgaucacuguaguc rope

# we are here testing of seg fault due to wrongly increased Iterator in hashmap (subopt.cc) passes
# See issue #38 @ github.com/jlab/gapc
GAPC="../../../gapc --subopt"
check_new_old_eq rnashapesmfe.gap unused mfeppshape "A" foo

#test new FLOAT terminal parser
GAPC="../../../gapc"
RUN_CPP_FLAGS=""
check_new_old_eq testfloat.gap unused enum "23" floatint
check_new_old_eq testfloat.gap unused enum "23.4" justfloat
check_new_old_eq testfloat.gap unused enum "23.45" largerfloat
check_new_old_eq testfloat.gap unused enum "23.45678" largerfloat2
check_new_old_eq testfloat.gap unused enum "23.00000009" smallpostradix
check_new_old_eq testfloat.gap unused enum "2.345e+06" failscientific

# test yield size analysis of const (i.e. string) terminal arguments, like ROPE("stefan")
check_compiler_output ../../grammar2 testtermarg.gap testme termarg grep "6), \"stefan" testtermarg.cc

# fixing missing includes when changing gapc flag --float-accuracy
GRAMMAR=../../grammar
GAPC="../../../gapc --float-accuracy 2"
check_new_old_eq elm.gap unused pareto "1+2*3+4*5" floatacc

GAPC="../../../gapc --checkpoint"
# int
check_checkpoint_eq adpf.gap unused mfe "GCUUCACAUCUCGGGCAUUUUCCUGCAAAACCAUACCCUUACGAAAAGUACGGCAUUGAUAAUCAUUUUCAAUAUCAUUUAAUUAACUAUAAUGAACCAACUGCUUACGCGGCAUUAACAAUCGGCCGCCCGACAAUACUGGAGAUGAAUAUGAGCUAUACCCUGCCAUCCCUGCCGUAUGCUUACGAUGCCCUGGAACCGCACUUCGAUAAGCAGACCAUGGAAAUCCACCACACCAAACACCAUCAGACCUACGUAAACAACGCCAACGCGGCGCUGGAAAGCCUGCCAGAAUUUGCCAACCUGCCGGUUGAAGAGCUGAUCACCAAACUGGACCAGCUGCCAGCAGACAAGAAAACCGUACUGCGCAACAACGCUGGCGGUCACGCUAACCACAGCCUGUUCUGGAAAGGUCUGAAAAAAGGCACCACCCUGCAGGGUGACCUGAAAGCGGCUAUCGAACGUGACUUCGGCUCCGUUGAUAACUUCAAAGCAGAAUUUGAAAAAGCGGCAGCUUCCCGCUUUGGUUCCGGCUGGGCAUGGCUGGUGCUGAAAGGCGAUAAACUGGCGGUGGUUUCUACUGCUAACCAGGAUUCUCCGCUGAUGGGUGAAGCUAUUUCUGGCGCUUCCGGCUUCCCGAUUAUGGGCCUGGAUGUGUGGGAACAUGCUUACUACCUGAAAUUCCAGAACCGCCGUCCGGACUACAUUAAAGAGUUCUGGAACGUGGUGAACUGGGACGAAGCAGCGGCACGUUUUGCGGCGAAAAAAUAA" checkpoint1 1
# int
check_checkpoint_eq adpf.gap unused mfe "GUAAAAUAAACAACGCUGAUAUUAGCCGUAAACAUCGGGUUUUUUACCUCGGUAUGCCUUGUGACUGGCUUGACAAGCUUUUCCUCAGCUCCGUAAACUCCUUUCAGUGGGAAAUUGUGGGGCAAAGUGGGAAUAAGGGGUGAGGCUGGCAUGUUCCGGGGAGCAACGUUAGUCAAUCUCGACAGCAAAGGGCGCUUAUCAGUGCCUACCCGUUAUCGGGAACAGCUGCUUGAGAACGCUGCCGGUCAAAUGGUUUGCACCAUUGACAUUUAUCACCCGUGCCUGCUGCUUUACCCCCUGCCUGAAUGGGAAAUUAUCGAGCAAAAAUUAUCGCGUCUGUCGAGCAUGAACCCGGUUGAGCGCCGUGUGCAGCGCCUACUGUUAGGUCAUGCCAGCGAAUGUCAGAUGGAUGGCGCAGGUCGAUUGUUAAUCGCGCCAGUACUGCGGCAACAUGCCGGGCUGACAAAAGAAGUGAUGCUGGUUGGACAGUUCAACAAGUUUGAGCUGUGGGAUGAAACAACCUGGCAUCAACAGGUCAAGGAAGAUAUCGACGCAGAGCAGUUGGCUACCGGAGACUUAUCGGAGCGACUGCAGGACUUGUCUCUAUAAACGAUCUGACGAGCGAUCUAGCGAGCAUCGAUCUGAUCAUCUACUAUCUAUUCUAUCUAUCGGGGUGUCGACGAUCU" checkpoint2 1
# int
check_checkpoint_eq adpf.gap unused mfe "GUUGUAGACUUUACAUCGCCAGGGGUGCUCGGCAUAAGCCGAAGAUAUCGGUAGAGUUAAUAUUGAGCAGAUCCCCCGGUGAAGGAUUUAACCGUGUUAUCUCGUUGGAGAUAUUCAUGGCGUAUUUUGGAUGAUAACGAGGCGCAAAAAAUGAAAAAGACAGCUAUCGCGAUUGCAGUGGCACUGGCUGGUUUCGCUACCGUAGCGCAGGCCGCUCCGAAAGAUAACACCUGGUACACUGGUGCUAAACUGGGCUGGUCCCAGUACCAUGACACUGGUUUCAUCAACAACAAUGGCCCGACCCAUGAAAACCAACUGGGCGCUGGUGCUUUUGGUGGUUACCAGGUUAACCCGUAUGUUGGCUUUGAAAUGGGUUACGACUGGUUAGGUCGUAUGCCGUACAAAGGCAGCGUUGAAAACGGUGCAUACAAAGCUCAGGGCGUUCAACUGACCGCUAAACUGGGUUACCCAAUCACUGACGACCUGGACAUCUACACUCGUCUGGGUGGCAUGGUAUGGCGUGCAGACACUAAAUCCAACGUUUAUGGUAAAAACCACGACACCGGCGUUUCUCCGGUCUUCGCUGGCGGUGUUGAGUACGCGAUCACUCCUGAAAUCGCUACCCGUCUGGAAUACCAGUGGACCAACAACAUCGGUGACGCACACACCAUCGGCACUCGUCCGGACAACGGCAUGCUGAGCCUGGGUGUUUCCUACCGUUUCGGUCAGGGCG" checkpoint3 1
# List_Ref<std::pair<int, String>
check_checkpoint_eq adpf.gap unused mfepp "CGUAGUCGUAGUUCUGAGUCGUAGUCGUAGUCGUGUACUGAGUGCUGUAGUCGUAGUCGUAGUCGUAGUCGUGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCUGUGAGUCGUAGUCGUAGUCGUAGUCGUAcGUCAGCGAGUCGUAGUCGUAGUCGUAGUCGAGUAGUCAGUCUGAGCAGUCUAGUGCUGUAGUCGUAGUCGUAGUCUGCUGACGUCGUAUGCGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUCGUAGUCGUAGUCAGUCGUAGUCGUAGUCGUAGUGUC" checkpoint4 1
# std::pair<int, Rope>
check_checkpoint_eq adpf.gap unused mfeen "CGAGCGGUACUGAGUCGUAGUGUAGUGCUCGUAGUCGUAGUCGUAGUCGUAGCUGAUCGUAGUAGUCGUCGUAGUCGUAGUCGUCGUAGCGUAGUCGUAGUCGUAGUCAGUCGUGUCGUGUACGUAGUCGUCAGUGCGAUCGUGUCGUAGUCGUCGUAGUCGUAGUCGAGUCAGUCGUAGUAGUGCUGAUCGUgauCGUAGCGUA" checkpoint5 1
# Hash::Ref<std::pair<Shape, double>>
check_checkpoint_eq adpf.gap unused shape5pfx "CGAGCGUAGUCGUAGCguCGUAGCGUAGUCGUAGUCGUGCUGAGUCguaCAGUCGGAGCUAGUCGUAGUCGUAGUCGUAGCUAGUCGUCGUAGUCGUAGUCGAGUCGUACGUCGUAGCGUAGUCGUAGCUAGUGUAGCUCGUAGUCGUGUCACACCGUAUA" checkpoint6 1
GAPC="../../../gapc --checkpoint --sample"
# double + Backtrace
check_checkpoint_eq adpf.gap unused pfsampleshape "CGAGCGGUACUGAGUCGUAGUGUAGUGCUCGUAGUCGUAGUCGUAGUCGUAGCUGAUCGUAGUAGUCGUCGUAGUCGUAGUCGUCGUAGCGUAGUCGUAGUCGUAGUCAGUCGUGUCGUGUACGUAGUCGUCAGUGCGAUCGUGUCGUAGUCGUCGUAGUCGUAGUCGAGUCAGUCGUAGUAGUGCUGAUCGUgauCGUAGCGUACGUACGUAGUCGUAGUCGUAGUCGUAGUCGAGUCCGUAGUCGUAGUCGUAGUCGUAGUCGUGUACGUACGUGUACGGUCGUAGUCGUAGCUguCGUAGCGUAGUCGUAGUCGUAGUCGUAGUCAGUCGUAGUGUAGUGUCGUCGUCGUAGUCGUAGUCGUAGUCAGUCGUAGUCGUAGUCGUAGUCGAUGUAGUGUCGUAGUCAGUCUGAGUCGUAGCGUAGUCGAUGUCAGUCGUAGUCGUAGUCGUAGUCGAUGCUAGUCCUGAGUCGUAGUCGUAGUCGAUCGUAGCUGAUCGUCGUAGUCGUAGUCGAGUCGACGUAGUCGUACGUAGUCGUACGUAGUCGUAGUACGUAGUGUACguCGUA" checkpoint7 1
GAPC="../../../gapc --checkpoint --cyk"
# std::pair<int, double> + cyk
check_checkpoint_eq adpf.gap unused mfepf "CGUAGCUGAUGCUGAGCGUCGUAUCUGAGUCGUGUAGUCGAUGUCGAUCGUAGUCGUGUCGAGUCGUAUGCGUAGCGUAGUCGUAGCUAGUCCGUAGCGUAGUCAGUGCUAGUGCUGCAGUGCUGAUCGUGUACGUCGAGUCGAGUCGUAGUCGUACGUAGUGCUAGUGCUAGUCGUAGUCGUGUCGUAGUCGUGAUGUCAGUGUCGUGUAGUCGUAGUCGUACGUGUACGUAGUCGUAGUCGUAUCGAGUCGCGUAGGCUAGUCGUAGUCGUAGUCGUGCGUAGCGUUGAGUCGUAGUCGAUGUCAGUCGUGUAGUCUGAGCUGAUCUGUUCGUAGCGUGUACGAGUCGUGUCGUGUAGCUGUAGUCGUAGUCAGUCAUGUAGUCGAUGCGUAGUCGUGUACGUGUAGUCGUAGUCGUAGUCGUGUAGUCGUAGUCGUAGUGUCGUAGCUGUAGUCGUGUAGUCGUAGUCUGAGUGUCGUAGUCGUCGUGUAGUCGUGUACGUGUAGUCGUGUAGUCGUAGUCGUAGUCGUUAUCGGAUGUCGUAGCUGUACGUGAUCGUCCGUC" checkpoint8 1
# std::pair<int, Rope> + cyk
check_checkpoint_eq adpf.gap unused mfeen "CGAGCGGUACUGAGUCGUAGUGUAGUGCUCGUAGUCGUAGUCGUAGUCGUAGCUGAUCGUAGUAGUCGUCGUAGUCGUAGUCGUCGUAGCGUAGUCGUAGUCGUAGUCAGUCGUGUCGUGUACGUAGUCGUCAGUGCGAUCGUGUCGUAGUCGUCGUAGUCGUAGUCGAGUCAGUCGUAGUAGUGCUGAUCGUgauCGUAGCGUA" checkpoint9 1
# std::pair<int, String> + cyk
check_checkpoint_eq adpf.gap unused mfepp "CGAGCGGUACUGAGUCGUAGUGUAGUGCUCGUAGUCGUAGUCGUAGUCGUAGCUGAUCGUAGUAGUCGUCGUAGUCGUAGUCGUCGUAGCGUAGUCGUAGUCGUAGUCAGUCGUGUCGUGUACGUAGUCGUCAGUGCGAUCGUGUCGUAGUCGUCGUAGUCGUAGUCGAGUCAGUCGUAGUAGUGCUGAUCGUgauCGUAGCGUAGUCGAUCGUGAUGUCGUAGUCGUGUAGCUGAUGCUGUAGUCGUAUGCGUAGUCGUGUACGUGUAGCU" checkpoint10 1
# std::pair<int, BigInt> + cyk + two track
check_checkpoint_eq affinelocsim2.gap unused affinecnt "CUGAAACGUAGUCUGAAAAGCCCGCGUAGUCGUAGUCGUAGUCGUACGUUAGCGUUGAGUCGUAGUCGUAGUUGAGUUCGGUAGUCGUAGUCGUGUACCACACAUGUGCGUAGUCGUCAGUCGUAGUCGUACGUCGUCUAGCGUGUCGUAUGCGUACGUAGUCGAGUCUGACGAGUGCGUGGGUCUGAGUCGUCGUUAGGCCAGUCGUAGUCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUU" checkpoint11 1 "CGUAUGGCUGUAGCUGUCGUAGCUAUGCGUGUACGUCGUAGUGCUAGUCGUAGUCGUAGUCGUCGUGUCAGUGUCCGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUCGUGAUGUCGUAGCGUAGUCGUGUCCGUAGUCGUAGUCGUAGUCGUGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUAGCUGUAGUCGUCGUAUGGCUGUAGCUGUCGUAGCUAUGCGUGUACGUCGUAGUGCUAGUCGUAGUCGUAGUCGUCGUGUCAGUGUCCGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUCGUGAUGUCGUAGCGUAGUCGUGUCCGUAGUCGUAGUCGUAGUCGUGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUAGCUGUAGUCGUCGUAUGGCUGUAGCUGUCGUAGCUAUGCGUGUACGUCGUAGUGCUAGUCGUAGUCGUAGUCGUCGUGUCAGUGUCCGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUCGUGAUGUCGUAGCGUAGUCGUGUCCGUAGUCGUAGUCGUAGUCGUGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUAGCUGUAGUCGUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUUGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUUCGUAGUCGUAGUCGUAGUCGUACGUCGUAUGCUGAGCAAAAAAUCGUAGUCCUGAGUCGUAGCAUGCGUACGACGUGUCCGUAGCGUACGUGUAGUACGUAGUCGAUCGUCUGAGUGUCGUAGUCGUAGUCCGUAGUCUGUAGUGUCGUACGUCGUGUAGUCGUAGCUGUAGUCGUAGUCGUAGUCGUUGCGUAGUCGUAGCGUACGUAGUGUAGUCGUCGUGUAGCGUACGUGU"
# std::pair<int, String> + cyk + two track
check_checkpoint_eq affinelocsim2.gap unused affinepp "CUGUCAGAGCUAGGCGUAGUCGUAGUCGUGUAGUCGUGUGUGUGUACGUAGUCCGUAGUCGUGAUGCUGAUCGUCGACGUGACGUCGUGUAGCUAGUCGUGUAGUCGUAGUCGUAGCGGGGCAGCGGUAUUUUGCGAUCGUAGUCGUAGUCGUAGUCGUAGUGUAGUGUCGUCCGUU" checkpoint12 1 "CGUAUGGCUGUAGCUGUCGUAGCUAUGCGUGUACGUCGUAGUGCUAGUCGUAGUCGUAGUCGUCGUGUCAGUGUCCGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUCGUGAUGUCGUAGCGUAGUCGUGUCCGUAGUCGUAGUCGUAGUCGUGUAGUCGUAGUCGUAGUCGUAGUCGUAGUCGUGUAGCUGUAGUCGUGUACGU"
GAPC="../../../gapc"
RUN_CPP_FLAGS=""
check_new_old_eq empty_ys_issue.gap unused count "A" Ashouldbe0
check_new_old_eq empty_ys_issue.gap unused count "AA" AAshouldbe1
check_new_old_eq empty_ys_issue.gap unused count "AAA" AAAshouldbe0
RUN_CPP_FLAGS=" -f emptyinput "
echo "" > emptyinput # create an input file with empty word, since '' as parameter is not correctly propagated through bash scripts
check_new_old_eq empty_ys_issue.gap unused count dummyinput shouldbe1
check_new_old_eq empty_ys_issue_larger.gap unused count dummyinput shouldbe1

# ensure that previously composed answers are not erased by later application of filters for completely different alternatives, see PR https://github.com/jlab/gapc/pull/123
GRAMMAR=../../grammar2
GAPC="../../../gapc"
RUN_CPP_FLAGS=""
check_new_old_eq eraseanswers.gap unused ins_count_failing "AC" eraseanswer
check_new_old_eq eraseanswers.gap unused ins_count_working "AC" eraseanswer
check_new_old_eq eraseanswers_product.gap unused ins "CaaG" eraseanswer_one
check_new_old_eq eraseanswers_product.gap unused ins "CaaaG" eraseanswer_four

# results have been verified against "RNAfold -p -d0 --bppmThreshold=0" v2.4.17 and Stefan's manual python outside version of nodangle
GRAMMAR=../../grammar_outside
GAPC="../../../gapc --outside_grammar weak --outside_grammar struct"
check_new_old_eq nodangle.gap unused pfunc "CCaCCaaaGGaCCaaaGGaCCaaaGGaGG" outside
check_new_old_eq nodangle.gap unused mfe "CCaCCaaaGGaCCaaaGGaCCaaaGGaGG" outside
check_new_old_eq nodangle.gap unused count "CCaCCaaaGGaCCaaaGGaCCaaaGGaGG" outside

# check that fn_arg (with alt) instead of only alt gets initialized
check_new_old_eq nodangle_withoverlay.gap unused ins_pfunc "CCaCCaaaGGaCCaaaGGaCCaaaGGaGG" outside_overlay












GAPC="../../../gapc --outside_grammar ALL"
CPPFLAGS_EXTRA=""
LDLIBS_EXTRA=""
check_new_old_eq hmm_sonneregen.gap unused count "SS" outside
check_new_old_eq hmm_sonneregen.gap unused fwd "SS" outside
check_new_old_eq hmm_sonneregen.gap unused fwd "SSRR" outside_ssrr

# example in which inside and outside NTs have different dimensions, don't use tmhmm_debug.gap as new semantic checks will prevent producing code
check_new_old_eq tmhmm_debug_nil.gap unused count "AA" outside_report

# example with multiple tracks for outside report function
check_new_old_eq_twotrack alignments.gap unused count "AAAA" outside_2track "BBB"
check_new_old_eq_twotrack alignments.gap unused sim_enum "AA" outside_undefvar "B"

# example with parameterized terminals e.g. ROPE("manfred")
check_new_old_eq elmamun.gap unused count "1+2*3" outside_elm

# check correct indices for multiple CONST_FLOAT args for outside generation; caused by incorrectly set yield size when replacing NTs
check_new_old_eq nonzero_constsize.gap unused count "G" outside_constissue

# test if outside to inside transitions works also for constant non-terminal tables, i.e. those missing t_0_i t_0_j parameters which should be replaced via dummies in this one and only situation
check_new_old_eq constAxiom.gap unused enum "G" outside_out2in

# check TMHMM outside with real sequence which previously revealed < 1.0 prob sums
CPPFLAGS_EXTRA=$DEFAULT_CPPFLAGS_EXTRA
check_new_old_eq tmhmm.gap unused fwd_scaled "MENLNMDLLYMAAAVMMGLAAIGAAIGIGILGGKFLEGAARQPDLIPLLRTQFFIVMGLVDAIPMIAVGLGLYVMFAVA" outside_tmhmm

check_new_old_eq RFmini.gap unused enum "G" outside_cm
check_new_old_eq RFmini.gap unused count "G" outside_cm

# Results can be converted into probabilities via nt_inside(i,j) + nt_outside(i,j) - axiom(0,n) - axiom(0,0)
# where axiom(0,0) is the pfunc value of the empty word. This words because we are in log2-space.
# Converted to probabilities: 2^nt_inside(i,j) * 2^nt_outside(i,j) / 2^axiom(0,n) / 2^axiom(0,0)
# The important aspect is that we have to also normalize by axiom(0,0) since the inside result of
# the empty word "" != 0 <-- log2-space but will be integrated in each and every outside candidate
check_new_old_eq RFmini.gap unused inside "G" outside_cm

# more extensive example as before, also checked against cm_OutsideAlign of Infernal
GAPC="../../../gapc --outside_grammar state_MR_3 --outside_grammar state_MP_6 --outside_grammar state_S_0 --outside_grammar state_E_120"
check_new_old_eq RF00005.gap unused inside "GACGGUAU" outside_cm5

GAPC="../../../gapc --outside_grammar a_1 --outside_grammar a_47 --outside_grammar a_82"
# not yet explored
check_new_old_eq acmsearch_RF00005.gap unused inside "GACGGUAU" outside_acm

CPPFLAGS_EXTRA=""